
<!doctype html>
<html>
  <head>
    <!-- 1140px Grid styles for IE -->
    <!--[if lte IE 9]><link rel="stylesheet" href="/assets/css/ie.css" type="text/css" media="screen" /><![endif]-->
    <link rel="stylesheet" href="/assets/css/1140.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="/assets/css/main.css"href="/assets/css/main.css" type="text/css" media="screen" >
    <link rel="alternate" type="application/atom+xml" title="Paperclip scaffolding - feed" href="http://feeds2.feedburner.com/patshaughnessy" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
    <title>Paperclip scaffolding - Pat Shaughnessy</title>
  </head>
<body>
  <div id="banner">
    <div class="row">
      <div class="onecol"></div>
      <div class="elevencol last">
        <a href="/">
          <span id="title">
            Pat Shaughnessy
          </span>
          <span id="tagline">
            blogger, rubyist, aspiring author
          </span>
        </a>
      </div>
    </div>
  </div>
  <div id="container">
    <div class="row">
      <div class="onecol"></div>
      
        <div class="ninecol white">
      
        <article class="post">
  <header>
  <h1>Paperclip scaffolding</h1>
  
  </header>

  <section class="content">
    <p>I just updated the <a href="http://patshaughnessy.net/view_mapper">View Mapper gem</a> to support Paperclip. You can use it to generate scaffolding code that supports uploading and downloading Paperclip file attachments.</p>


<p><b>Creating a view for an existing model</b></p>


<p>If you have a model like this:</p>


<pre>class Song &lt; ActiveRecord::Base
  has_attached_file :mp3
end</pre>


<p>&hellip; you can generate a &ldquo;Paperclip view&rdquo; for this model like this:</p>


<pre>script/generate view_for song --view paperclip</pre>


<p>This will generate a controller, view and other code files that support uploading and downloading files. If you run your app you&rsquo;ll see the typical scaffolding user interface but with a file field for the &ldquo;mp3&rdquo; Paperclip attachment:</p>


<p><img src="http://patshaughnessy.net/assets/2009/10/16/new_song.png"/></p>


<p>View Mapper has:
<ul>
  <li>inspected your model (&ldquo;Song&rdquo; in this example) and found its Paperclip attachments and other standard ActiveRecord attributes</li>
  <li>called the Rails scaffold generator and passed in the ActiveRecord columns it found</li>
  <li>added additional view code to support Paperclip  (e.g. set the form to use multipart/form-data encoding)</li>
  <li>created a file field in the form for each Paperclip attachment (&ldquo;mp3&rdquo; in this example), as well as a link to each attachment in the show view code file.</li></ul>
<p>If you&rsquo;re not very familiar with Paperclip and how to use it or if you just want to get a Rails upload form working very quickly, then View Mapper can help you.</p>
<p><b>Creating an entirely new Paperclip model and view</b></p>
<p>View Mapper also provides a generator called &ldquo;scaffold_for_view&rdquo; that is identical to the standard Rails scaffold generator, except it will create the specified view. As an example, let&rsquo;s create a new Rails app from scratch that uses Paperclip; you should be able to type in these precise commands on your machine and get this example to work.</p>
<p>First, let&rsquo;s install View Mapper and create a new Rails app to display my MP3 library online (ignoring copyright issues for now):</p>
<pre>$ gem sources -a http://gemcutter.org
http://gemcutter.org added to sources
$ sudo gem install view_mapper
Successfully installed view_mapper-0.2.0
1 gem installed
Installing ri documentation for view_mapper-0.2.0...
Installing RDoc documentation for view_mapper-0.2.0...
$ rails music
      create  
      create  app/controllers
      create  app/helpers
      create  app/models
      create  app/views/layouts
etc&hellip;</pre>
<p>And now we can generate a new &ldquo;Song&rdquo; model that has a Paperclip attachment called &ldquo;MP3&rdquo; using View Mapper like this:</p>
<pre>$ cd music
$ ./script/generate scaffold_for_view song name:string artist:string
                    album:string play_count:integer --view paperclip:mp3
       error  The Paperclip plugin does not appear to be installed.</pre>
<p>Wait&hellip; I forgot to install Paperclip; let&rsquo;s do that and then try again:</p>
<pre>$ ./script/plugin install git://github.com/thoughtbot/paperclip.git
Initialized empty Git repository in /Users/pat/rails-apps/music/vendor/plugins/paperclip/.git/
remote: Counting objects: 71, done.
remote: Compressing objects: 100% (59/59), done.
remote: Total 71 (delta 7), reused 29 (delta 3)
Unpacking objects: 100% (71/71), done.
From git://github.com/thoughtbot/paperclip
 * branch            HEAD       -&gt; FETCH_HEAD
$ ./script/generate scaffold_for_view song name:string artist:string
                    album:string play_count:integer --view paperclip:mp3
      exists  app/models/
      exists  app/controllers/
      exists  app/helpers/
      create  app/views/songs
      exists  app/views/layouts/
      exists  test/functional/
etc&hellip;</pre>
<p>Finally, we just need to run db:migrate &ndash; one minor detail here is that the scaffold_for_view generator included the Paperclip columns (&ldquo;mp3_file_name,&rdquo; &ldquo;mp3_content_type,&rdquo; etc&hellip;) in the migration file to create the songs table:</p>
<pre>$ rake db:migrate
(in /Users/pat/rails-apps/music)
==  CreateSongs: migrating ====================================================
-- create_table(:songs)
   -&gt; 0.0022s
==  CreateSongs: migrated (0.0024s) ===========================================</pre>
<p>Now you can run your app and see the scaffolding UI I showed above, and will be able to upload and download MP3 files using Paperclip.</p>
<p>Let&rsquo;s take a quick look at exactly what is different about the scaffolding code View Mapper generated vs. the standard Rails scaffolding code:</p>
<pre>&lt;h1&gt;New song&lt;/h1&gt;

&lt;% form_for(@song<b>, :html =&gt; { :multipart =&gt; true }</b>) do |f| %&gt;
  &lt;%= f.error_messages %&gt;
  &lt;p&gt;
    &lt;%= f.label :name %&gt;&lt;br /&gt;
    &lt;%= f.text_field :name %&gt;
  &lt;/p&gt;

&hellip; etc &hellip;

<b>  &lt;p&gt;
    &lt;%= f.label :mp3 %&gt;&lt;br /&gt;
    &lt;%= f.file_field :mp3 %&gt;
  &lt;/p&gt;</b>
  &lt;p&gt;
    &lt;%= f.submit &#x27;Create&#x27; %&gt;
  &lt;/p&gt;
&lt;% end %&gt;

&lt;%= link_to &#x27;Back&#x27;, songs_path %&gt;</pre>
<p>The code in bold was generated by View Mapper specifically to support Paperclip since we used the &ldquo;--view paperclip&rdquo; command line option. You can see that &ldquo;:html =&gt; { :multipart =&gt; :true }&rdquo; was added to form_for to allow for file uploads, and also a file_field was added for the mp3 Paperclip attachment.</p>
<p>If you take a look at the show view, you&rsquo;ll see:</p>
<pre>&lt;p&gt;
  &lt;b&gt;Name:&lt;/b&gt;
  &lt;%=h @song.name %&gt;
&lt;/p&gt;

&hellip; etc &hellip;

<b>&lt;p&gt;
  &lt;b&gt;Mp3:&lt;/b&gt;
  &lt;%= link_to @song.mp3_file_name, @song.mp3.url %&gt;&lt;br&gt;
&lt;/p&gt;</b>

&lt;%= link_to &#x27;Edit&#x27;, edit_song_path(@song) %&gt; |
&lt;%= link_to &#x27;Back&#x27;, songs_path %&gt;</pre>
<p>Here a link to the file attachment was added, using Paperclip to provide the name and URL of the attachment.</p>
<p>Next I&rsquo;ll be adding support for nested attributes and complex forms to View Mapper.</p>


  </section>

  
</article>


      </div>
      
        <div class="twocol last" id="right">
          <div id="sidebar">
            <img src="/assets/images/pat.jpg"/>
            <div class="header">Subscribe</a></div>
            <div class="links">
              <ul>
                <li>
                  <a href="https://twitter.com/pat_shaughnessy" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @pat_shaughnessy</a>
                  <a href="http://feeds.feedburner.com/patshaughnessy"><img src="/assets/images/feed-icon16x16B.png"/>
                  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                  <a href="http://twitter.com/pat_shaughnessy">@pat_shaughnessy</a>
                </li>
              </ul>
            </div>
            <div class="header">Buy my book</div>
            <div class="links">
              <ul>
                <li><a href="/ruby-under-a-microscope"><img src="/assets/images/book-cover.png"></a></li>
                <li id="eBook"><a href="/ruby-under-a-microscope">Ruby Under a Microscope</a></li>
              </ul>
            </div>
            <div class="header">Popular</div>
            <div class="links">
              <ul>
                <li><a href="/2012/1/4/never-create-ruby-strings-longer-than-23-characters">Never create Ruby strings longer than 23 characters</a></li>
                <li><a href="/2012/3/23/why-you-should-be-excited-about-garbage-collection-in-ruby-2-0">Why You Should Be Excited About Garbage Collection in Ruby 2.0</a></li>
                <li><a href="/2013/10/24/visualizing-garbage-collection-in-ruby-and-python">Visualizing Garbage Collection in Ruby and Python</a></li>
                <li><a href="/2012/2/29/the-joke-is-on-us-how-ruby-1-9-supports-the-goto-statement">The Joke Is On Us: How Ruby 1.9 Supports the Goto Statement</a></li>
              </ul>
            </div>
            <div class="header">Recent</div>
            <div class="links">
              <ul>
                
                  <li><a href="/2014/6/16/a-rule-of-thumb-for-strong-parameters">A Rule of Thumb for Strong Parameters</a></li>
                
                  <li><a href="/2014/4/8/using-a-ruby-class-to-write-functional-code">Using a Ruby Class To Write Functional Code</a></li>
                
                  <li><a href="/2014/2/10/use-an-ask-dont-tell-policy-with-ruby">Use An Ask, Don’t Tell Policy With Ruby</a></li>
                
                  <li><a href="/2014/1/30/what-does--f----x---f-x--a---a--b---b-mean">What does (((λ f . (λ x . (f x))) (λ a . a)) (λ b . b)) mean?</a></li>
                
              </ul>
            </div>
            <div class="header"><a href="/">More...</a></div>
          </div>
        </div>
      
    <div class="row" id="copyright">
      <p>Content and UI design &copy; 2014 Pat Shaughnessy</a>
    </div>
  </div>

</body>
</html>

